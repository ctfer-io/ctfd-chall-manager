services:
  ctfd:
    image: ctferio/ctfd:latest
    ports:
      - 8000:8000
    environment:
      PLUGIN_SETTINGS_CM_API_URL: http://chall-manager:8080
    depends_on:
      - chall-manager

  chall-manager:
    image: ctferio/chall-manager:v0.6.0@sha256:4d0a0379a3c12b2203500a7852856ef7202c7c54d58207fb88d4b8919d5f6add # TODO configure dependabot to monitor this tag
    environment:
      OCI_INSECURE: true
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock # Used by the example scenario, remove if unecessary

  chall-manager-janitor:
    image: ctferio/chall-manager-janitor:v0.6.0@sha256:0194e6652aabe59539c1c167e15cc987309c4f49e65c9f3370f358d822246e6e # TODO configure dependabot to monitor this tag
    environment:
      URL: chall-manager:8080
      TICKER: 1m

  # Start a registry if --profile registry is provided
  registry:
    image: registry:2
    ports:
      - 5000:5000
    profiles: ["registry"]