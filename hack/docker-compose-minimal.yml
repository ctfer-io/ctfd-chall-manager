services:
  ctfd:
    image: ctferio/ctfd:3.7.7-0.4.0
    ports:
      - 8000:8000
    environment:
      PLUGIN_SETTINGS_CM_API_URL: http://chall-manager:8080
    depends_on:
      - chall-manager

  chall-manager:
    image: ctferio/chall-manager:v0.5.0@sha256:a197c53b5b64b91ec4397d90c81e3a43808c1349ef5eec38bb611a074d9d11a2 # TODO configure dependabot to monitor this tag
    environment:
      OCI_INSECURE: true
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock # Used by the example scenario, remove if unecessary

  chall-manager-janitor:
    image: ctferio/chall-manager-janitor:v0.5.0@sha256:34f08d0d1968b892a4ddbac7c8736e7187cbe7a06ee97cc2bc419e660a6386ba # TODO configure dependabot to monitor this tag
    environment:
      URL: chall-manager:8080
      TICKER: 1m

  # Start a registry if --profile registry is provided
  registry:
    image: registry:2
    ports:
      - 5000:5000
    profiles: ["registry"]