<style>
	#cm-mode-until {
	  display: none;
	}
</style>
  
{% extends "admin/challenges/create.html" %}

{% block header %}
<div class="alert alert-secondary" role="alert">
	IaC challenges are special challenge that allows the Player to deploy his personnal challenges Instance.
	Challmakers provides the Scenario, which is the IaC Pulumi package to be execute by Chall-Manager.
	This type is based on dynamic challenge type.
</div>
{% endblock %}

{% block value %}
<!-- Chall-manager specifics -->
<div class="form-group">
	<label for="value">Mana Cost<br>
		<small class="form-text text-muted">
			This is how many points the challenge will cost to User to start it.
		</small>
	</label>
	<input type="number" data-test-id="mana-create-id" class="form-control" name="mana_cost" placeholder="Enter Mana value" required>
</div>

<div class="form-group">
	<label for="value">Update Strategy<br>
		<small class="form-text text-muted">
			<span>The UpdateStrategy to use in case of a Challenge scenario update with running instances.
				Default strategy is the update-in-place.</span>
			<ul>
				<li>Update in place: This updates the existing state based on the new stack in the scenario. This update strategy provide high availability with low update costs.</li>
				<li>Blue Green: spins up a second instance of the scenario in parallel and once up, delete the previous one for players to shift. This update strategy provide high availability with high update costs due to infra deduplication.</li>
				<li>Recreate: recreate delete the previous instance then spins up a fresh instance of the scenario. This update strategy provide no availability guarantee with medium update costs due to intensive create/delete operations. It should be used at a last relief, for instance if the update is inconsistent and the outcomes are not predictable.</li>
			</ul>
		</small>
	</label>
	<select name="updateStrategy" data-test-id="updateStrategy-create-id" class="custom-select">
		<option value="update_in_place">Update in place</option>
		<option value="blue_green">Blue Green</option>
		<option value="recreate">Recreate</option>
	</select>
</div>


<div id="cm-mode-selector" class="form-group">
	<label for="select-option">Select mode </label>
	<select id="select-option" data-test-id="mode-create-id" name="mode">
		<option value="until">Until</option>
		<option value="timeout" selected>Timeout</option>
	</select>
</div>

<div id="cm-mode-until" style="display: none;" class="form-group">
	<label for="value">Until<br>
		<small class="form-text text-muted">
			This is when the Scenario has to end. 
		</small>
	</label>
	<input type="datetime-local" id="until-input-local" data-test-id="until-create-id" class="form-control">
	<input type="hidden" id="until-input-utc" class="form-control" name="until">
</div>

<div id="cm-mode-timeout" class="form-group">
	<label for="value">Timeout<br>
		<small class="form-text text-muted">
			This is default timeout (int) <b>in seconds</b> for the Scenario to shutdown itself.
		</small>
	</label>
	<input type="number" id="timeout-input" data-test-id="timeout-create-id" class="form-control" name="timeout">
</div>

<div class="form-group">
	<label for="value">Scenario archive<br>
		<small class="form-text text-muted">
			This is the IaC Archives
		</small>
	</label>
	<input type="file" class="form-control" id="scenario" data-test-id="scenario-create-id" name="scenario" accept=".zip" required>
</div>
<!-- Chall-manager specifics -->

<div class="form-group">
	<label for="value">Initial Value<br>
		<small class="form-text text-muted">
			This is how many points the challenge is worth initially.
		</small>
	</label>
	<input type="number" class="form-control" name="initial" placeholder="Enter value" required>
</div>

<div class="form-group">
	<label for="value">Decay Function<br>
		<small class="form-text text-muted">
			<span>How the dynamic value will be calculated based on the Decay value</span>
			<ul>
				<li>Linear: Calculated as <code>Initial - (Decay * SolveCount)</code></li>
				<li>Logarithmic: Calculated as <code>(((Minimum - Initial) / (Decay^2)) * (SolveCount^2)) + Initial</code></li>
			</ul>
		</small>
	</label>
	<select name="function" class="custom-select">
		<option value="linear">Linear</option>
		<option value="logarithmic">Logarithmic</option>
	</select>
</div>

<div class="form-group">
	<label for="value">Decay<br>
		<small class="form-text text-muted">
			<span>The decay value is used differently depending on the above Decay Function</span>
			<ul>
				<li>Linear: The amount of points deducted per solve. Equal deduction per solve.</li>
				<li>Logarithmic: The amount of solves before the challenge reaches its minimum value. Earlier solves will lose less
					points. Later solves will lose more points</li>
			</ul>
		</small>
	</label>
	<input type="number" class="form-control" name="decay" min="1" placeholder="Enter Decay value" required>
</div>

<div class="form-group">
	<label for="value">Minimum Value<br>
		<small class="form-text text-muted">
			This is the lowest that the challenge can be worth
		</small>
	</label>
	<input type="number" class="form-control" name="minimum" placeholder="Enter minimum value" required>
</div>
{% endblock %}

{% block type %}
<input type="hidden" value="dynamic_iac" name="type" id="chaltype">
{% endblock %}
